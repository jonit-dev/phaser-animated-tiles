!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["AnimatedTiles.min"]=t():e["AnimatedTiles.min"]=t()}(window,function(){return i={},a.m=n=[function(e,t,n){"use strict";var i=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(e){var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));return t.map=null,t.animatedTiles=[],t.rate=1,t.active=!1,t.activeLayer=[],t.followTimeScale=!0,e.sys.settings.isBooted||e.sys.events.once("boot",t.boot,t),t}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),i(n,[{key:"boot",value:function(){var e=this.systems.events;e.on("postupdate",this.postUpdate,this),e.on("shutdown",this.shutdown,this),e.on("destroy",this.destroy,this)}},{key:"init",value:function(e){var t={map:e,animatedTiles:this.getAnimatedTiles(e),active:!0,rate:1,activeLayer:[]};e.layers.forEach(function(){return t.activeLayer.push(!0)}),this.animatedTiles.push(t),1===this.animatedTiles.length&&(this.active=!0)}},{key:"setRate",value:function(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;null===i?null===e?this.rate=t:this.animatedTiles[e].rate=t:(n=function(e){e.forEach(function(e){e.index===i&&(e.rate=t)})},null===e?this.animatedTiles.forEach(function(e){n(e.animatedTiles)}):n(this.animatedTiles[e].animatedTiles))}},{key:"resetRates",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;null===e?(this.rate=1,this.animatedTiles.forEach(function(e){e.rate=1,e.animatedTiles.forEach(function(e){e.rate=1})})):(this.animatedTiles[e].rate=1,this.animatedTiles[e].animatedTiles.forEach(function(e){e.rate=1}))}},{key:"resume",value:function(){var t=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=null===e?this:this.animatedTiles[e];null===n?e.active=!0:(e.activeLayer[n]=!0,e.animatedTiles.forEach(function(e){t.updateLayer(e,e.tiles[n])}))}},{key:"pause",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=null===t?this:this.animatedTiles[t];null===e?t.active=!1:t.activeLayer[e]=!1}},{key:"postUpdate",value:function(e,t){var n,r=this;this.active&&(n=t*this.rate*(this.followTimeScale?this.scene.time.timeScale:1),this.animatedTiles.forEach(function(a){var t;a.active&&(t=n*a.rate,a.animatedTiles.forEach(function(n){var i,e;n.next-=t*n.rate,n.next<0&&(e=n.currentFrame,i=n.frames[e].tileid,(e=e+1)>n.frames.length-1&&(e=0),n.next=n.frames[e].duration,n.currentFrame=e,n.tiles.forEach(function(e,t){a.activeLayer[t]&&r.updateLayer(n,e,i)}))}))}))}},{key:"updateLayer",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,i=[],a=e.frames[e.currentFrame].tileid;t.forEach(function(e){-1<n&&(null===e||e.index!==n)?i.push(e):e.index=a}),i.forEach(function(e){e=t.indexOf(e);-1<e?t.splice(e,1):console.error("This shouldn't happen. Not at all. Blame Phaser Animated Tiles plugin. You'll be fine though.")})}},{key:"shutdown",value:function(){this.animatedTiles.length=0}},{key:"destroy",value:function(){this.shutdown(),this.scene=void 0}},{key:"getAnimatedTiles",value:function(t){var n=this,r=[];return t.tilesets.forEach(function(a){var e=a.tileData;Object.keys(e).forEach(function(n){var i;n=parseInt(n),e[n].hasOwnProperty("animation")&&(i={index:n+a.firstgid,frames:[],currentFrame:0,tiles:[],rate:1},e[n].animation.forEach(function(e){e={duration:e.duration,tileid:e.tileid+a.firstgid};i.frames.push(e)}),i.next=i.frames[0].duration,i.currentFrame=i.frames.findIndex(function(e){return e.tileid===n+a.firstgid}),t.layers.forEach(function(e){var t;e.tilemapLayer&&e.tilemapLayer.type&&"StaticTilemapLayer"===e.tilemapLayer.type?i.tiles.push([]):(t=[],e.data.forEach(function(e){e.forEach(function(e){e&&e.index-a.firstgid===n&&t.push(e)})}),i.tiles.push(t))}),r.push(i))})}),t.layers.forEach(function(e,t){n.activeLayer[t]=!0}),r}},{key:"putTileAt",value:function(e,t,n,i){}},{key:"updateAnimatedTiles",value:function(){var t=null,t=[];this.animatedTiles.forEach(function(e){t.push(e)}),t.forEach(function(l){l.animatedTiles.forEach(function(o){o.tiles.forEach(function(e,t){var n=l.map.layers[t];if(!n.type||"StaticTilemapLayer"!==n.type)for(var i=0;i<10;i++)for(var a=0;a<10;a++){var r=l.map.layers[t].data[i][a];r.index==o.index&&(-1===e.indexOf(r)&&e.push(r),r.index=o.frames[o.currentFrame].tileid)}})})})}}]),n}(Phaser.Plugins.ScenePlugin);r.register=function(e){e.register("AnimatedTiles",r,"animatedTiles")},e.exports=r}],a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0);function a(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}var n,i});